const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MeterValueCurveModal-ClIEDJdE.js","assets/index-BjgGgDfQ.js","assets/index-Dr41GKjs.css"])))=>i.map(i=>d[i]);
import{r as i,j as e,O as d,k as s,_ as $e,l as X,m as Ve,u as ie,n as Ue,o as Fe,p as Le,q as He,s as Be,t as oe}from"./index-BjgGgDfQ.js";import{H as p,P as b,u as Pe,a as We,b as Ye,i as Je,B as Ke,C as Xe,M as qe}from"./style-B2i4GXyF.js";const ze=({data:a,selected:n})=>{const r=m=>{switch(m){case d.Available:return"bg-green-500";case d.Charging:return"bg-blue-500";case d.Unavailable:return"bg-gray-500";case d.Faulted:return"bg-red-500";default:return"bg-yellow-500"}};return e.jsxs("div",{className:`px-4 py-3 rounded-lg border-2 bg-white dark:bg-gray-800 min-w-[180px] ${n?"border-blue-500":"border-gray-300 dark:border-gray-600"}`,children:[e.jsx(p,{type:"target",position:b.Top,className:"w-3 h-3"}),e.jsx("div",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mb-1",children:"Status Change"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${r(a.status)}`}),e.jsx("div",{className:"font-bold text-sm text-primary",children:a.status})]}),a.description&&e.jsx("div",{className:"text-xs text-muted mt-1",children:a.description}),e.jsx(p,{type:"source",position:b.Bottom,className:"w-3 h-3"})]})},Qe=i.memo(ze),Ze=({data:a,selected:n})=>{const r=a.action==="start"?"bg-green-600":"bg-orange-600",m=a.action==="start"?"â–¶":"â– ";return e.jsxs("div",{className:`px-4 py-3 rounded-lg border-2 bg-white dark:bg-gray-800 min-w-[180px] ${n?"border-blue-500":"border-gray-300 dark:border-gray-600"}`,children:[e.jsx(p,{type:"target",position:b.Top,className:"w-3 h-3"}),e.jsx("div",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mb-1",children:"Transaction"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-6 h-6 rounded ${r} flex items-center justify-center text-white text-xs`,children:m}),e.jsx("div",{className:"font-bold text-sm text-primary",children:a.action==="start"?"Start":"Stop"})]}),a.action==="start"&&a.tagId&&e.jsxs("div",{className:"text-xs text-muted mt-1",children:["Tag: ",a.tagId]}),a.description&&e.jsx("div",{className:"text-xs text-muted mt-1",children:a.description}),e.jsx(p,{type:"source",position:b.Bottom,className:"w-3 h-3"})]})},et=i.memo(Ze),tt=({data:a,selected:n})=>{const r=a.progress,m=r?(r.total-r.remaining)/r.total*100:0,S=a.currentValue!==void 0?a.currentValue:a.value;return e.jsxs("div",{className:`px-4 py-3 rounded-lg border-2 bg-white dark:bg-gray-800 min-w-[180px] ${n?"border-blue-500":"border-gray-300 dark:border-gray-600"}`,children:[e.jsx(p,{type:"target",position:b.Top,className:"w-3 h-3"}),e.jsx("div",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mb-1",children:"Meter Value"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-2xl",children:"âš¡"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-bold text-sm text-primary",children:[S," Wh"]}),e.jsx("div",{className:"text-xs text-muted",children:a.sendMessage?"Send message":"Set value only"})]})]}),a.description&&e.jsx("div",{className:"text-xs text-muted mt-1",children:a.description}),a.autoIncrement&&e.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400 mt-1 font-semibold",children:["âš¡ Auto +",a.incrementAmount||1e3,"Wh / ",a.incrementInterval||10,"s",r&&r.remaining>0&&e.jsxs("span",{className:"ml-1",children:["(",r.remaining.toFixed(1),"s)"]})]}),a.autoIncrement&&r&&r.remaining>0&&e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"w-full h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 dark:bg-green-400 transition-all duration-100",style:{width:`${m}%`}})})}),e.jsx(p,{type:"source",position:b.Bottom,className:"w-3 h-3"})]})},at=i.memo(tt),st=({data:a,selected:n})=>{const r=a.progress,m=r?(r.total-r.remaining)/r.total*100:0;return e.jsxs("div",{className:`px-4 py-3 rounded-lg border-2 bg-white dark:bg-gray-800 min-w-[180px] ${n?"border-blue-500":"border-gray-300 dark:border-gray-600"}`,children:[e.jsx(p,{type:"target",position:b.Top,className:"w-3 h-3"}),e.jsx("div",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mb-1",children:"Delay"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-2xl",children:"â±ï¸"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-bold text-sm text-primary",children:[a.delaySeconds,"s"]}),r&&r.remaining>0?e.jsxs("div",{className:"text-xs text-blue-600 dark:text-blue-400 font-semibold",children:[r.remaining.toFixed(1),"s remaining"]}):e.jsx("div",{className:"text-xs text-muted",children:"Wait"})]})]}),r&&r.remaining>0&&e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"w-full h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 dark:bg-blue-400 transition-all duration-100",style:{width:`${m}%`}})})}),a.description&&e.jsx("div",{className:"text-xs text-muted mt-1",children:a.description}),e.jsx(p,{type:"source",position:b.Bottom,className:"w-3 h-3"})]})},rt=i.memo(st),nt=({data:a,selected:n})=>e.jsxs("div",{className:`px-4 py-3 rounded-lg border-2 bg-white dark:bg-gray-800 min-w-[180px] ${n?"border-blue-500":"border-gray-300 dark:border-gray-600"}`,children:[e.jsx(p,{type:"target",position:b.Top,className:"w-3 h-3"}),e.jsx("div",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mb-1",children:"Notification"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-2xl",children:"ðŸ“¤"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-sm text-primary",children:a.messageType}),e.jsx("div",{className:"text-xs text-muted",children:"Send message"})]})]}),a.description&&e.jsx("div",{className:"text-xs text-muted mt-1",children:a.description}),e.jsx(p,{type:"source",position:b.Bottom,className:"w-3 h-3"})]}),lt=i.memo(nt),it=({data:a,selected:n})=>{const r=a.action==="plugin"?"ðŸ”Œ":"ðŸ”“",m=a.action==="plugin"?"Plug In":"Plug Out",S=a.action==="plugin"?"text-green-600":"text-red-600";return e.jsxs("div",{className:`px-4 py-3 rounded-lg border-2 bg-white dark:bg-gray-800 min-w-[180px] ${n?"border-blue-500":"border-gray-300 dark:border-gray-600"}`,children:[e.jsx(p,{type:"target",position:b.Top,className:"w-3 h-3"}),e.jsx("div",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mb-1",children:"Connector Plug"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-2xl",children:r}),e.jsxs("div",{children:[e.jsx("div",{className:`font-bold text-sm ${S}`,children:m}),e.jsx("div",{className:"text-xs text-muted",children:"Cable action"})]})]}),a.description&&e.jsx("div",{className:"text-xs text-muted mt-1",children:a.description}),e.jsx(p,{type:"source",position:b.Bottom,className:"w-3 h-3"})]})},ot=i.memo(it),dt=({data:a,selected:n})=>{const r=a.progress,m=r?(r.total-r.remaining)/r.total*100:0;return e.jsxs("div",{className:`px-4 py-3 rounded-lg border-2 bg-purple-50 dark:bg-purple-900 min-w-[180px] ${n?"border-blue-500":"border-purple-400 dark:border-purple-600"}`,children:[e.jsx(p,{type:"target",position:b.Top,className:"w-3 h-3"}),e.jsx("div",{className:"text-xs font-semibold text-purple-600 dark:text-purple-300 mb-1",children:"Remote Start Trigger"}),e.jsx("div",{className:"font-bold text-sm text-primary mb-1",children:a.label}),a.timeout!==void 0&&a.timeout>0&&e.jsxs("div",{className:"text-xs text-muted",children:["Timeout: ",a.timeout,"s",r&&r.remaining>0&&e.jsxs("span",{className:"ml-1 text-purple-600 dark:text-purple-400 font-semibold",children:["(",r.remaining.toFixed(1),"s left)"]})]}),(!a.timeout||a.timeout===0)&&e.jsx("div",{className:"text-xs text-muted",children:"No timeout"}),r&&r.remaining>0&&e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"w-full h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-purple-500 dark:bg-purple-400 transition-all duration-100",style:{width:`${m}%`}})})}),e.jsx(p,{type:"source",position:b.Bottom,className:"w-3 h-3"})]})},ct=i.memo(dt),ut=({data:a,selected:n})=>{const r=a.progress,m=r?(r.total-r.remaining)/r.total*100:0;return e.jsxs("div",{className:`px-4 py-3 rounded-lg border-2 bg-orange-50 dark:bg-orange-900 min-w-[180px] ${n?"border-blue-500":"border-orange-400 dark:border-orange-600"}`,children:[e.jsx(p,{type:"target",position:b.Top,className:"w-3 h-3"}),e.jsx("div",{className:"text-xs font-semibold text-orange-600 dark:text-orange-300 mb-1",children:"Status Trigger"}),e.jsx("div",{className:"font-bold text-sm text-primary mb-1",children:a.label}),e.jsxs("div",{className:"text-xs text-muted",children:["Wait for: ",e.jsx("span",{className:"font-semibold",children:a.targetStatus})]}),a.timeout!==void 0&&a.timeout>0&&e.jsxs("div",{className:"text-xs text-muted",children:["Timeout: ",a.timeout,"s",r&&r.remaining>0&&e.jsxs("span",{className:"ml-1 text-orange-600 dark:text-orange-400 font-semibold",children:["(",r.remaining.toFixed(1),"s left)"]})]}),r&&r.remaining>0&&e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"w-full h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-orange-500 dark:bg-orange-400 transition-all duration-100",style:{width:`${m}%`}})})}),e.jsx(p,{type:"source",position:b.Bottom,className:"w-3 h-3"})]})},xt=i.memo(ut),mt=({data:a,selected:n})=>e.jsxs("div",{className:`px-4 py-3 rounded-lg border-2 bg-amber-50 dark:bg-amber-900 min-w-[180px] ${n?"border-blue-500":"border-amber-400 dark:border-amber-600"}`,children:[e.jsx(p,{type:"target",position:b.Top,className:"w-3 h-3"}),e.jsx("div",{className:"text-xs font-semibold text-amber-600 dark:text-amber-300 mb-1",children:"Reserve Now"}),e.jsx("div",{className:"font-bold text-sm text-primary mb-1",children:a.label}),e.jsxs("div",{className:"text-xs text-muted space-y-0.5",children:[e.jsxs("div",{children:["ID Tag: ",a.idTag]}),e.jsxs("div",{children:["Expiry: ",a.expiryMinutes," min"]}),a.parentIdTag&&e.jsxs("div",{children:["Parent: ",a.parentIdTag]}),a.reservationId&&e.jsxs("div",{children:["Reservation ID: ",a.reservationId]})]}),e.jsx(p,{type:"source",position:b.Bottom,className:"w-3 h-3"})]}),gt=i.memo(mt),pt=({data:a,selected:n})=>e.jsxs("div",{className:`px-4 py-3 rounded-lg border-2 bg-orange-50 dark:bg-orange-900 min-w-[180px] ${n?"border-blue-500":"border-orange-400 dark:border-orange-600"}`,children:[e.jsx(p,{type:"target",position:b.Top,className:"w-3 h-3"}),e.jsx("div",{className:"text-xs font-semibold text-orange-600 dark:text-orange-300 mb-1",children:"Cancel Reservation"}),e.jsx("div",{className:"font-bold text-sm text-primary mb-1",children:a.label}),e.jsxs("div",{className:"text-xs text-muted",children:["Reservation ID: ",a.reservationId]}),e.jsx(p,{type:"source",position:b.Bottom,className:"w-3 h-3"})]}),bt=i.memo(pt),ht=({data:a,selected:n})=>{const r=a.progress,m=r?(r.total-r.remaining)/r.total*100:0;return e.jsxs("div",{className:`px-4 py-3 rounded-lg border-2 bg-yellow-50 dark:bg-yellow-900 min-w-[180px] ${n?"border-blue-500":"border-yellow-400 dark:border-yellow-600"}`,children:[e.jsx(p,{type:"target",position:b.Top,className:"w-3 h-3"}),e.jsx("div",{className:"text-xs font-semibold text-yellow-600 dark:text-yellow-300 mb-1",children:"Reservation Trigger"}),e.jsx("div",{className:"font-bold text-sm text-primary mb-1",children:a.label}),a.timeout!==void 0&&a.timeout>0&&e.jsxs("div",{className:"text-xs text-muted",children:["Timeout: ",a.timeout,"s",r&&r.remaining>0&&e.jsxs("span",{className:"ml-1 text-yellow-600 dark:text-yellow-400 font-semibold",children:["(",r.remaining.toFixed(1),"s left)"]})]}),(!a.timeout||a.timeout===0)&&e.jsx("div",{className:"text-xs text-muted",children:"No timeout"}),r&&r.remaining>0&&e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"w-full h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-yellow-500 dark:bg-yellow-400 transition-all duration-100",style:{width:`${m}%`}})})}),e.jsx(p,{type:"source",position:b.Bottom,className:"w-3 h-3"})]})},yt=i.memo(ht),Nt=({selected:a,nodeType:n})=>{const r=n==="start",m=r?"bg-green-100 dark:bg-green-900":"bg-red-100 dark:bg-red-900",S=r?"border-green-500":"border-red-500",O=r?"text-green-700 dark:text-green-300":"text-red-700 dark:text-red-300";return e.jsxs("div",{className:`px-6 py-4 rounded-full border-2 ${m} min-w-[120px] ${a?"border-blue-500":S}`,children:[!r&&e.jsx(p,{type:"target",position:b.Top,className:"w-3 h-3"}),e.jsx("div",{className:`text-center font-bold ${O}`,children:r?"ðŸŸ¢ Start":"ðŸ”´ End"}),r&&e.jsx(p,{type:"source",position:b.Bottom,className:"w-3 h-3"})]})},de=i.memo(Nt),ft={id:"smart-charging",name:"Smart Charging (Auto MeterValue)",description:"Auto-increment MeterValue when Charging, stop when Finishing",targetType:"connector",createScenario:(a,n)=>({id:`scenario-${Date.now()}`,name:"Smart Charging",description:"Auto MeterValue with status triggers",targetType:"connector",targetId:n??void 0,nodes:[{id:"start-1",type:s.START,position:{x:400,y:50},data:{label:"Start"}},{id:"trigger-charging",type:s.STATUS_TRIGGER,position:{x:400,y:150},data:{label:"Wait for Charging",targetStatus:d.Charging,timeout:0}},{id:"meter-auto",type:s.METER_VALUE,position:{x:400,y:250},data:{label:"Start Auto MeterValue",value:0,sendMessage:!0,autoIncrement:!0,incrementInterval:10,incrementAmount:1e3,maxValue:3e4,maxTime:0}},{id:"trigger-finish",type:s.STATUS_TRIGGER,position:{x:400,y:350},data:{label:"Wait for Finishing",targetStatus:d.Finishing,timeout:0}},{id:"end-1",type:s.END,position:{x:400,y:450},data:{label:"End"}}],edges:[{id:"e-start-charging",source:"start-1",target:"trigger-charging"},{id:"e-charging-meter",source:"trigger-charging",target:"meter-auto"},{id:"e-meter-finish",source:"meter-auto",target:"trigger-finish"},{id:"e-finish-end",source:"trigger-finish",target:"end-1"}],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),trigger:{type:"manual"},defaultExecutionMode:"oneshot",enabled:!0})},vt={id:"multi-status-monitor",name:"Multi-Status Monitor (Parallel)",description:"Monitor multiple statuses in parallel and execute different actions",targetType:"connector",createScenario:(a,n)=>({id:`scenario-${Date.now()}`,name:"Multi-Status Monitor",description:"Parallel status monitoring",targetType:"connector",targetId:n??void 0,nodes:[{id:"start-1",type:s.START,position:{x:400,y:50},data:{label:"Start"}},{id:"trigger-available",type:s.STATUS_TRIGGER,position:{x:150,y:200},data:{label:"Wait: Available",targetStatus:d.Available,timeout:0}},{id:"notify-available",type:s.NOTIFICATION,position:{x:150,y:300},data:{label:"Send Heartbeat",messageType:"Heartbeat",payload:{}}},{id:"end-available",type:s.END,position:{x:150,y:400},data:{label:"End"}},{id:"trigger-charging",type:s.STATUS_TRIGGER,position:{x:400,y:200},data:{label:"Wait: Charging",targetStatus:d.Charging,timeout:0}},{id:"meter-charging",type:s.METER_VALUE,position:{x:400,y:300},data:{label:"Auto MeterValue",value:0,sendMessage:!0,autoIncrement:!0,incrementInterval:10,incrementAmount:1e3,maxValue:2e4,maxTime:0}},{id:"end-charging",type:s.END,position:{x:400,y:400},data:{label:"End"}},{id:"trigger-faulted",type:s.STATUS_TRIGGER,position:{x:650,y:200},data:{label:"Wait: Faulted",targetStatus:d.Faulted,timeout:0}},{id:"notify-faulted",type:s.NOTIFICATION,position:{x:650,y:300},data:{label:"Send Status",messageType:"StatusNotification",payload:{status:"Faulted"}}},{id:"end-faulted",type:s.END,position:{x:650,y:400},data:{label:"End"}}],edges:[{id:"e-start-available",source:"start-1",target:"trigger-available"},{id:"e-available-notify",source:"trigger-available",target:"notify-available"},{id:"e-notify-end1",source:"notify-available",target:"end-available"},{id:"e-start-charging",source:"start-1",target:"trigger-charging"},{id:"e-charging-meter",source:"trigger-charging",target:"meter-charging"},{id:"e-meter-end2",source:"meter-charging",target:"end-charging"},{id:"e-start-faulted",source:"start-1",target:"trigger-faulted"},{id:"e-faulted-notify",source:"trigger-faulted",target:"notify-faulted"},{id:"e-notify-end3",source:"notify-faulted",target:"end-faulted"}],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),trigger:{type:"manual"},defaultExecutionMode:"oneshot",enabled:!0})},jt={id:"full-charging-cycle",name:"Full Charging Cycle",description:"Complete charging cycle with AutoMeterValue",targetType:"connector",createScenario:(a,n)=>({id:`scenario-${Date.now()}`,name:"Full Charging Cycle",description:"Complete charging cycle",targetType:"connector",targetId:n??void 0,nodes:[{id:"start-1",type:s.START,position:{x:400,y:50},data:{label:"Start"}},{id:"status-available",type:s.STATUS_CHANGE,position:{x:400,y:150},data:{label:"Set Available",status:d.Available}},{id:"status-preparing",type:s.STATUS_CHANGE,position:{x:400,y:250},data:{label:"Set Preparing",status:d.Preparing}},{id:"transaction-start",type:s.TRANSACTION,position:{x:400,y:350},data:{label:"Start Transaction",action:"start",tagId:"USER001",batteryCapacityKwh:60,initialSoc:20}},{id:"status-charging",type:s.STATUS_CHANGE,position:{x:400,y:450},data:{label:"Set Charging",status:d.Charging}},{id:"meter-auto",type:s.METER_VALUE,position:{x:400,y:550},data:{label:"Auto MeterValue",value:0,sendMessage:!0,autoIncrement:!0,incrementInterval:5,incrementAmount:500,maxValue:25e3,maxTime:300}},{id:"delay-charging",type:s.DELAY,position:{x:400,y:650},data:{label:"Charging Complete",delaySeconds:5}},{id:"transaction-stop",type:s.TRANSACTION,position:{x:400,y:750},data:{label:"Stop Transaction",action:"stop"}},{id:"status-finishing",type:s.STATUS_CHANGE,position:{x:400,y:850},data:{label:"Set Finishing",status:d.Finishing}},{id:"status-available2",type:s.STATUS_CHANGE,position:{x:400,y:950},data:{label:"Set Available",status:d.Available}},{id:"end-1",type:s.END,position:{x:400,y:1050},data:{label:"End"}}],edges:[{id:"e-start-available",source:"start-1",target:"status-available"},{id:"e-available-preparing",source:"status-available",target:"status-preparing"},{id:"e-preparing-txstart",source:"status-preparing",target:"transaction-start"},{id:"e-txstart-charging",source:"transaction-start",target:"status-charging"},{id:"e-charging-meter",source:"status-charging",target:"meter-auto"},{id:"e-meter-delay",source:"meter-auto",target:"delay-charging"},{id:"e-delay-txstop",source:"delay-charging",target:"transaction-stop"},{id:"e-txstop-finishing",source:"transaction-stop",target:"status-finishing"},{id:"e-finishing-available2",source:"status-finishing",target:"status-available2"},{id:"e-available2-end",source:"status-available2",target:"end-1"}],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),trigger:{type:"manual"},defaultExecutionMode:"oneshot",enabled:!0})},St={id:"status-triggered-actions",name:"Status-Triggered Auto Actions",description:"Auto-execute on status change (Heartbeat loop when Available)",targetType:"connector",createScenario:(a,n)=>({id:`scenario-${Date.now()}`,name:"Auto Heartbeat",description:"Periodic Heartbeat sender",targetType:"connector",targetId:n??void 0,nodes:[{id:"start-1",type:s.START,position:{x:400,y:50},data:{label:"Start"}},{id:"trigger-available",type:s.STATUS_TRIGGER,position:{x:400,y:150},data:{label:"Wait for Available",targetStatus:d.Available,timeout:0}},{id:"notification-heartbeat",type:s.NOTIFICATION,position:{x:400,y:250},data:{label:"Send Heartbeat",messageType:"Heartbeat",payload:{}}},{id:"delay-10s",type:s.DELAY,position:{x:400,y:350},data:{label:"Wait 10s",delaySeconds:10}},{id:"end-1",type:s.END,position:{x:400,y:450},data:{label:"End"}}],edges:[{id:"e-start-trigger",source:"start-1",target:"trigger-available"},{id:"e-trigger-notify",source:"trigger-available",target:"notification-heartbeat"},{id:"e-notify-delay",source:"notification-heartbeat",target:"delay-10s"},{id:"e-delay-notify",source:"delay-10s",target:"notification-heartbeat"}],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),trigger:{type:"statusChange",conditions:{toStatus:d.Available}},defaultExecutionMode:"oneshot",enabled:!0})},Tt={id:"remote-start-auto-meter",name:"Remote Start + Auto MeterValue",description:"Wait RemoteStartTransaction â†’ Start charging â†’ AutoMeterValue",targetType:"connector",createScenario:(a,n)=>({id:`scenario-${Date.now()}`,name:"Remote Start + Auto Meter",description:"Remote start with automatic meter value",targetType:"connector",targetId:n??void 0,nodes:[{id:"start-1",type:s.START,position:{x:400,y:50},data:{label:"Start"}},{id:"trigger-remote",type:s.REMOTE_START_TRIGGER,position:{x:400,y:150},data:{label:"Wait RemoteStart",timeout:0}},{id:"status-preparing",type:s.STATUS_CHANGE,position:{x:400,y:250},data:{label:"Set Preparing",status:d.Preparing}},{id:"transaction-start",type:s.TRANSACTION,position:{x:400,y:350},data:{label:"Start Transaction",action:"start",tagId:"REMOTE001"}},{id:"status-charging",type:s.STATUS_CHANGE,position:{x:400,y:450},data:{label:"Set Charging",status:d.Charging}},{id:"meter-auto",type:s.METER_VALUE,position:{x:400,y:550},data:{label:"Auto MeterValue",value:0,sendMessage:!0,autoIncrement:!0,incrementInterval:10,incrementAmount:1e3,maxValue:0,maxTime:0}},{id:"end-1",type:s.END,position:{x:400,y:650},data:{label:"End"}}],edges:[{id:"e-start-remote",source:"start-1",target:"trigger-remote"},{id:"e-remote-preparing",source:"trigger-remote",target:"status-preparing"},{id:"e-preparing-tx",source:"status-preparing",target:"transaction-start"},{id:"e-tx-charging",source:"transaction-start",target:"status-charging"},{id:"e-charging-meter",source:"status-charging",target:"meter-auto"},{id:"e-meter-end",source:"meter-auto",target:"end-1"}],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),trigger:{type:"manual"},defaultExecutionMode:"oneshot",enabled:!0})},ce=[jt,ft,vt,St,Tt];function Ct(a){return ce.find(n=>n.id===a)}const wt=i.lazy(()=>$e(()=>import("./MeterValueCurveModal-ClIEDJdE.js"),__vite__mapDeps([0,1,2]))),Et={[s.STATUS_CHANGE]:Qe,[s.TRANSACTION]:et,[s.METER_VALUE]:at,[s.DELAY]:rt,[s.NOTIFICATION]:lt,[s.CONNECTOR_PLUG]:ot,[s.REMOTE_START_TRIGGER]:ct,[s.STATUS_TRIGGER]:xt,[s.RESERVE_NOW]:gt,[s.CANCEL_RESERVATION]:bt,[s.RESERVATION_TRIGGER]:yt,[s.START]:a=>e.jsx(de,{...a,nodeType:"start"}),[s.END]:a=>e.jsx(de,{...a,nodeType:"end"})},Mt=({chargePoint:a,connectorId:n,scenario:r,scenarioId:m,executionContext:S,nodeProgress:O,onClose:ue})=>{var re,ne,le;const[f,_]=i.useState(()=>{if(r)return r;if(m){const t=X(a.id,n,m);if(t)return t}return Ve(a.id,n)}),[v,N,xe]=Pe(f.nodes),[A,T,me]=We(f.edges),[w,G]=i.useState("idle"),[kt,q]=i.useState("oneshot"),[k,L]=i.useState(null),[E,I]=i.useState(null),[l,g]=i.useState({}),[z,Q]=i.useState(d.Unavailable),[ge,Z]=i.useState(0),[ee,pe]=i.useState(null),[te,be]=i.useState({}),[ae,H]=i.useState(!1),[B,P]=i.useState(f.name),[W,Y]=i.useState(f.description||""),[M,J]=i.useState(f.defaultExecutionMode||"oneshot"),[$,K]=i.useState(f.enabled!==!1),R=i.useRef(null),se=i.useRef(null);i.useEffect(()=>{if(r){_(r),N(r.nodes),T(r.edges),P(r.name),Y(r.description||""),J(r.defaultExecutionMode||"oneshot"),K(r.enabled!==!1);return}if(m){const t=X(a.id,n,m);t&&(_(t),N(t.nodes),T(t.edges),P(t.name),Y(t.description||""),J(t.defaultExecutionMode||"oneshot"),K(t.enabled!==!1))}},[r,m,a.id,n,N,T]),i.useEffect(()=>{S?(L(S),G(S.state),q(S.mode)):L(null)},[S]),i.useEffect(()=>{O&&be(O)},[O]),i.useEffect(()=>{if(!k){N(t=>t.map(o=>({...o,className:(o.className||"").replace(/executing-node|executed-node/g,"").trim(),style:{...o.style,border:void 0,boxShadow:void 0,opacity:1},data:{...o.data,progress:void 0}})));return}N(t=>t.map(o=>{const x=o.id===k.currentNodeId,c=k.executedNodes.includes(o.id),u=te[o.id];let h=o.className||"",y={...o.style};return x?(h=`${h} executing-node`,y={...y,border:"3px solid #10b981",boxShadow:"0 0 10px rgba(16, 185, 129, 0.5)"}):c?(h=`${h} executed-node`,y={...y,opacity:.6}):(h=h.replace(/executing-node|executed-node/g,"").trim(),y={...y,border:void 0,boxShadow:void 0,opacity:1}),{...o,className:h,style:y,data:{...o.data,progress:u||void 0}}}))},[k,te,N]),i.useEffect(()=>{if(!n)return;const t=a.getConnector(n);if(!t)return;const o=t.events.on("statusChange",u=>{Q(u.status)}),x=t.events.on("meterValueChange",u=>{Z(u.meterValue)}),c=t.events.on("transactionIdChange",u=>{pe(u.transactionId)});return Q(t.status),Z(t.meterValue),()=>{o(),x(),c()}},[a,n]),i.useEffect(()=>{let t=null;const o=v.find(j=>j.type===s.STATUS_TRIGGER);if(o){const j=o.data;j.targetStatus&&(t={type:"statusChange",conditions:{toStatus:j.targetStatus}},console.log(`[ScenarioEditor] Auto-detected trigger from StatusTriggerNode: toStatus=${j.targetStatus}`))}const x=t||{type:"manual"},c=new Set(v.map(j=>j.id)),u=A.filter(j=>{const D=c.has(j.source),Ge=c.has(j.target);return!D||!Ge?(console.warn(`[ScenarioEditor] Removing orphaned edge: ${j.source} -> ${j.target}`),!1):!0});u.length!==A.length&&T(u);const h={...f,name:B,description:W,nodes:v,edges:u,trigger:x,defaultExecutionMode:M,enabled:$,updatedAt:new Date().toISOString()};_(h),f.id&&ie(a.id,n,f.id,h);const y=a.getConnector(n||1);if(y!=null&&y.scenarioManager){const j=Ue(a.id,n);y.scenarioManager.loadScenarios(j)}},[v,A,B,W,M,$,T,f.id,a.id,n,a]);const he=i.useCallback(t=>{T(o=>Ye(t,o))},[T]),ye=i.useCallback(t=>{t.forEach(o=>{(E==null?void 0:E.id)===o.id&&I(null)})},[E]),Ne=i.useCallback(()=>{N(t=>t.filter(o=>!o.selected)),T(t=>t.filter(o=>!o.selected)),I(null)},[N,T]),fe=i.useCallback(t=>{t.preventDefault(),t.dataTransfer.dropEffect="move"},[]),ve=i.useCallback(t=>{t.preventDefault();const o=t.dataTransfer.getData("application/reactflow");if(!o)return;if(o===s.START&&v.some(y=>y.type===s.START)){alert("Only one Start node is allowed per scenario");return}if(o===s.END&&v.some(y=>y.type===s.END)){alert("Only one End node is allowed per scenario");return}const x=t.currentTarget.getBoundingClientRect(),c={x:t.clientX-x.left-90,y:t.clientY-x.top-30},u=At(o,c);N(h=>h.concat(u))},[N,v]),U=i.useCallback(async t=>{var c;if(a.status!==d.Available){console.warn(`[ScenarioEditor] ChargePoint status is ${a.status}. Scenario execution skipped.`);return}(c=R.current)==null||c.stop(),N(u=>u.map(h=>({...h,style:{}})));const o={...f,nodes:v,edges:A},x=n?a.getConnector(n):null;if(!x){console.warn("Connector not found. Scenario execution aborted.");return}R.current=new Fe(o,Le({chargePoint:a,connector:x,hooks:{onStateChange:u=>{G(u.state),L(u)},onNodeExecute:u=>{N(h=>h.map(y=>({...y,style:y.id===u?{boxShadow:"0 0 10px 3px #3b82f6"}:{}})))},onNodeProgress:(u,h,y)=>{N(j=>j.map(D=>D.id===u?{...D,data:{...D.data,progress:{remaining:h,total:y}}}:D))},onError:u=>{console.error("Scenario execution error:",u),alert(`Scenario error: ${u.message}`)}}})),q(t),await R.current.start(t)},[f,v,A,a,n,N]),je=i.useCallback(()=>{var t;if(w==="idle"){U("step"),setTimeout(()=>{var o;(o=R.current)==null||o.forceStep()},0);return}(t=R.current)==null||t.forceStep()},[w,U]),Se=i.useCallback(()=>{var t;(t=R.current)==null||t.stop(),G("idle"),N(o=>o.map(x=>({...x,style:{}})))},[N]),V=i.useRef(null),F=i.useRef(null);i.useEffect(()=>{var c,u,h;if(!$){(c=R.current)==null||c.stop(),G("idle"),F.current=null;return}const t=v.some(y=>y.type===s.STATUS_TRIGGER);if(((u=f.trigger)==null?void 0:u.type)!=="manual"||t){(h=R.current)==null||h.stop(),G("idle"),F.current=null;return}if(w!=="idle"||!(n?a.getConnector(n):null))return;const x=`${f.id}:${f.updatedAt||""}:${M}`;if(F.current!==x)return F.current=x,V.current&&clearTimeout(V.current),V.current=setTimeout(()=>{U(M)},300),()=>{V.current&&clearTimeout(V.current)}},[f.id,f.updatedAt,(re=f.trigger)==null?void 0:re.type,v,M,$,w,n,a,U]);const Te=i.useCallback(()=>{const t={...f,nodes:v,edges:A};He(t)},[f,v,A]),Ce=i.useCallback(()=>{var t;(t=se.current)==null||t.click()},[]),we=i.useCallback(async t=>{var x;const o=(x=t.target.files)==null?void 0:x[0];if(o)try{const c=await Be(o);_(c),N(c.nodes),T(c.edges),X(a.id,n,c.id)?ie(a.id,n,c.id,c):oe(a.id,n,c)}catch(c){alert(`Failed to import scenario: ${c}`)}},[a.id,n,N,T]),Ee=i.useCallback(t=>{const o=Ct(t);if(!o){alert("Template not found");return}if(v.length>2&&!window.confirm("Discard the current scenario and load the template?"))return;const x=o.createScenario(a.id,n);_(x),N(x.nodes),T(x.edges),oe(a.id,n,x)},[a.id,n,v.length,N,T]),Ae=i.useCallback((t,o)=>{o.type===s.START||o.type===s.END||(I(o),g({...o.data}))},[]),ke=i.useCallback((t,o)=>{N(x=>x.map(c=>c.id===t?{...c,data:{...c.data,...o}}:c))},[N]),Re=t=>{switch(t){case d.Available:return"status-available";case d.Preparing:return"status-preparing";case d.Charging:return"status-charging";case d.Finishing:return"text-yellow-600 dark:text-yellow-400";case d.Unavailable:return"status-unavailable";case d.Faulted:return"status-error";default:return"text-secondary"}},Ie=t=>{switch(t){case"idle":return"text-gray-600 dark:text-gray-400";case"running":return"text-green-600 dark:text-green-400";case"paused":return"text-yellow-600 dark:text-yellow-400";case"waiting":return"text-orange-600 dark:text-orange-400";case"stepping":return"text-purple-600 dark:text-purple-400";case"completed":return"text-emerald-600 dark:text-emerald-400";case"error":return"text-red-600 dark:text-red-400";default:return"text-gray-600 dark:text-gray-400"}},Me=t=>{switch(t){case"idle":return e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"â—"});case"running":return e.jsx("span",{className:"text-green-500 animate-pulse",children:"â—"});case"paused":return e.jsx("span",{className:"text-yellow-500",children:"â¸"});case"waiting":return e.jsx("span",{className:"text-orange-500 animate-pulse",children:"â³"});case"stepping":return e.jsx("span",{className:"text-purple-500",children:"â¯"});case"completed":return e.jsx("span",{className:"text-emerald-500",children:"âœ“"});case"error":return e.jsx("span",{className:"text-red-500",children:"âœ—"});default:return e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"â—"})}},De=t=>{switch(t){case s.STATUS_CHANGE:return"Status Change";case s.TRANSACTION:return"Transaction";case s.METER_VALUE:return"Meter Value";case s.DELAY:return"Delay";case s.NOTIFICATION:return"Notification";case s.CONNECTOR_PLUG:return"Connector Plug";case s.REMOTE_START_TRIGGER:return"Remote Start Trigger";case s.STATUS_TRIGGER:return"Status Trigger";default:return"Node"}},Oe=()=>{if(!E)return null;switch(E.type){case s.STATUS_CHANGE:return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-primary mb-1",children:"Label"}),e.jsx("input",{type:"text",className:"input-base w-full text-sm",value:l.label||"",onChange:t=>g({...l,label:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-primary mb-1",children:"Status"}),e.jsx("select",{className:"input-base w-full text-sm",value:l.status||d.Available,onChange:t=>g({...l,status:t.target.value}),children:Object.values(d).map(t=>e.jsx("option",{value:t,children:t},t))})]})]});case s.TRANSACTION:return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-primary mb-1",children:"Label"}),e.jsx("input",{type:"text",className:"input-base w-full text-sm",value:l.label||"",onChange:t=>g({...l,label:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-primary mb-1",children:"Action"}),e.jsxs("select",{className:"input-base w-full text-sm",value:l.action||"start",onChange:t=>g({...l,action:t.target.value}),children:[e.jsx("option",{value:"start",children:"Start Transaction"}),e.jsx("option",{value:"stop",children:"Stop Transaction"})]})]}),l.action==="start"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-primary mb-1",children:"Tag ID"}),e.jsx("input",{type:"text",className:"input-base w-full text-sm",value:l.tagId||"",onChange:t=>g({...l,tagId:t.target.value}),placeholder:"RFID123456"})]})]});case s.METER_VALUE:return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-primary mb-1",children:"Label"}),e.jsx("input",{type:"text",className:"input-base w-full text-sm",value:l.label||"",onChange:t=>g({...l,label:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-primary mb-1",children:"Initial Value (Wh)"}),e.jsx("input",{type:"number",className:"input-base w-full text-sm",value:l.value||0,onChange:t=>g({...l,value:parseInt(t.target.value)||0})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"sendMessage",checked:l.sendMessage||!1,onChange:t=>g({...l,sendMessage:t.target.checked}),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"sendMessage",className:"text-xs font-semibold text-primary",children:"Send MeterValue Message"})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{type:"checkbox",id:"autoIncrement",checked:l.autoIncrement||!1,onChange:t=>g({...l,autoIncrement:t.target.checked}),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"autoIncrement",className:"text-xs font-semibold text-primary",children:"Auto Increment"})]}),l.autoIncrement&&e.jsxs("div",{className:"ml-6 space-y-2",children:[e.jsx("button",{onClick:()=>H(!0),className:"btn-primary text-sm w-full",children:"âš™ï¸ Configure Auto Increment Curve"}),e.jsx("p",{className:"text-xs text-muted",children:l.curvePoints&&l.curvePoints.length>0?`Configured with ${l.curvePoints.length} curve points`:"Click to configure meter value auto-increment curve"})]})]})]});case s.DELAY:return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-primary mb-1",children:"Label"}),e.jsx("input",{type:"text",className:"input-base w-full text-sm",value:l.label||"",onChange:t=>g({...l,label:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-primary mb-1",children:"Delay (seconds)"}),e.jsx("input",{type:"number",className:"input-base w-full text-sm",value:l.delaySeconds||0,onChange:t=>g({...l,delaySeconds:parseInt(t.target.value)||0}),min:"0"})]})]});case s.NOTIFICATION:return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-primary mb-1",children:"Label"}),e.jsx("input",{type:"text",className:"input-base w-full text-sm",value:l.label||"",onChange:t=>g({...l,label:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-primary mb-1",children:"Message Type"}),e.jsx("input",{type:"text",className:"input-base w-full text-sm",value:l.messageType||"",onChange:t=>g({...l,messageType:t.target.value}),placeholder:"e.g., Heartbeat, DataTransfer"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-primary mb-1",children:"Payload (JSON)"}),e.jsx("textarea",{className:"input-base w-full font-mono text-xs",rows:6,value:typeof l.payload=="string"?l.payload:JSON.stringify(l.payload||{},null,2),onChange:t=>{try{const o=JSON.parse(t.target.value);g({...l,payload:o})}catch{g({...l,payload:t.target.value})}},placeholder:'{"key": "value"}'})]})]});case s.CONNECTOR_PLUG:return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-primary mb-1",children:"Label"}),e.jsx("input",{type:"text",className:"input-base w-full text-sm",value:l.label||"",onChange:t=>g({...l,label:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-primary mb-1",children:"Action"}),e.jsxs("select",{className:"input-base w-full text-sm",value:l.action||"plugin",onChange:t=>g({...l,action:t.target.value}),children:[e.jsx("option",{value:"plugin",children:"Plugin (Connect)"}),e.jsx("option",{value:"plugout",children:"Plugout (Disconnect)"})]})]})]});case s.REMOTE_START_TRIGGER:return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-primary mb-1",children:"Label"}),e.jsx("input",{type:"text",className:"input-base w-full text-sm",value:l.label||"",onChange:t=>g({...l,label:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-primary mb-1",children:"Timeout (seconds)"}),e.jsx("input",{type:"number",className:"input-base w-full text-sm",value:l.timeout||0,onChange:t=>g({...l,timeout:parseInt(t.target.value)||0}),min:"0"}),e.jsx("p",{className:"text-xs text-muted mt-1",children:"0 = No timeout (wait indefinitely for RemoteStartTransaction)"})]})]});case s.STATUS_TRIGGER:return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-primary mb-1",children:"Label"}),e.jsx("input",{type:"text",className:"input-base w-full text-sm",value:l.label||"",onChange:t=>g({...l,label:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-primary mb-1",children:"Target Status"}),e.jsxs("select",{className:"input-base w-full text-sm",value:l.targetStatus||d.Charging,onChange:t=>g({...l,targetStatus:t.target.value}),children:[e.jsx("option",{value:d.Available,children:"Available"}),e.jsx("option",{value:d.Preparing,children:"Preparing"}),e.jsx("option",{value:d.Charging,children:"Charging"}),e.jsx("option",{value:d.SuspendedEVSE,children:"SuspendedEVSE"}),e.jsx("option",{value:d.SuspendedEV,children:"SuspendedEV"}),e.jsx("option",{value:d.Finishing,children:"Finishing"}),e.jsx("option",{value:d.Reserved,children:"Reserved"}),e.jsx("option",{value:d.Unavailable,children:"Unavailable"}),e.jsx("option",{value:d.Faulted,children:"Faulted"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-primary mb-1",children:"Timeout (seconds)"}),e.jsx("input",{type:"number",className:"input-base w-full text-sm",value:l.timeout||0,onChange:t=>g({...l,timeout:parseInt(t.target.value)||0}),min:"0"}),e.jsx("p",{className:"text-xs text-muted mt-1",children:"0 = No timeout (wait indefinitely for status change)"})]})]});default:return e.jsx("div",{className:"text-sm text-muted",children:"This node type does not have configurable properties."})}},_e=t=>{g({...l,curvePoints:t.curvePoints,incrementInterval:t.intervalSeconds,autoCalculateInterval:t.autoCalculateInterval}),H(!1)};return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50 dark:bg-gray-900",children:[ae?e.jsx(i.Suspense,{fallback:e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center",children:e.jsx("div",{className:"text-white",children:"Loading..."})}),children:e.jsx(wt,{isOpen:ae,onClose:()=>H(!1),initialConfig:{enabled:!0,intervalSeconds:l.incrementInterval||10,curvePoints:l.curvePoints||[{time:0,value:0},{time:30,value:50}],autoCalculateInterval:l.autoCalculateInterval||!1},onSave:_e})}):null,e.jsxs("div",{className:"panel p-3 border-b border-gray-200 dark:border-gray-700 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-primary",children:"Scenario Editor"}),e.jsxs("p",{className:"text-xs text-muted",children:[a.id," -"," ",n?`Connector ${n}`:"ChargePoint"]})]}),e.jsxs("div",{className:"flex gap-2",children:[n&&e.jsx("div",{className:"panel-border px-3 py-1",children:e.jsxs("div",{className:"flex items-center gap-3 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted",children:"Status: "}),e.jsx("span",{className:`font-semibold ${Re(z)}`,children:z})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted",children:"Meter: "}),e.jsxs("span",{className:"font-mono text-secondary",children:[ge," Wh"]})]}),ee&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted",children:"TX: "}),e.jsx("span",{className:"font-mono text-secondary",children:ee})]})]})}),e.jsx("div",{className:"panel-border px-3 py-1",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:"text-muted",children:"Scenario State:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[Me(w),e.jsx("span",{className:`font-semibold ${Ie(w)}`,children:w?w.charAt(0).toUpperCase()+w.slice(1):"Idle"})]}),k&&k.currentNodeId&&e.jsxs("div",{className:"border-l border-gray-300 dark:border-gray-600 pl-2",children:[e.jsx("span",{className:"text-muted",children:"Current Node: "}),e.jsx("span",{className:"font-mono text-blue-600 dark:text-blue-400",children:((le=(ne=v.find(t=>t.id===k.currentNodeId))==null?void 0:ne.data)==null?void 0:le.label)||k.currentNodeId})]})]})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:Ce,className:"btn-secondary text-xs px-2 py-1",children:"ðŸ“¥ Import"}),e.jsx("button",{onClick:Te,className:"btn-secondary text-xs px-2 py-1",children:"ðŸ“¤ Export"}),e.jsx("button",{onClick:ue,className:"btn-danger text-xs px-2 py-1",children:"âœ• Close"})]}),e.jsx("input",{ref:se,type:"file",accept:".json",onChange:we,className:"hidden"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs font-semibold text-primary whitespace-nowrap",children:"ðŸ“‹ Template:"}),e.jsxs("select",{className:"input-base text-xs flex-1",onChange:t=>{t.target.value&&(Ee(t.target.value),t.target.value="")},defaultValue:"",children:[e.jsx("option",{value:"",children:"Select a template..."}),ce.map(t=>e.jsxs("option",{value:t.id,children:[t.name," - ",t.description]},t.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-primary mb-1",children:"Scenario Name"}),e.jsx("input",{type:"text",className:"input-base w-full text-xs",value:B,onChange:t=>P(t.target.value),placeholder:"Enter scenario name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-primary mb-1",children:"Execution Mode"}),e.jsxs("select",{className:"input-base w-full text-xs",value:M,onChange:t=>J(t.target.value),children:[e.jsx("option",{value:"oneshot",children:"One-shot"}),e.jsx("option",{value:"step",children:"Step"})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-xs font-semibold text-primary mb-1",children:"Description"}),e.jsx("input",{type:"text",className:"input-base w-full text-xs",value:W,onChange:t=>Y(t.target.value),placeholder:"Enter scenario description (optional)"})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"mr-2",checked:$,onChange:t=>K(t.target.checked)}),e.jsx("span",{className:"text-xs font-semibold text-primary",children:"Enabled"})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:je,className:"btn-info text-xs px-3 py-1.5",children:"Force Step"}),e.jsx("button",{onClick:Se,className:"btn-danger text-xs px-3 py-1.5",children:"Stop"})]})]})]}),e.jsxs("div",{className:"flex-1 flex gap-3 p-3 overflow-hidden min-h-0",children:[e.jsxs("div",{className:"flex-1 flex flex-col gap-3 overflow-hidden min-h-0",children:[e.jsxs("div",{className:"panel p-2 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-xs font-semibold text-primary",children:"Node Palette"}),e.jsx("button",{onClick:Ne,className:"btn-danger text-xs px-2 py-1",title:"Delete selected nodes and edges (or press Delete/Backspace)",children:"ðŸ—‘ï¸ Delete Selected"})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(C,{type:s.START,label:"Start",icon:"ðŸŸ¢"}),e.jsx(C,{type:s.END,label:"End",icon:"ðŸ”´"}),e.jsx(C,{type:s.STATUS_CHANGE,label:"Status",icon:"ðŸ“Š"}),e.jsx(C,{type:s.TRANSACTION,label:"Transaction",icon:"ðŸ’³"}),e.jsx(C,{type:s.METER_VALUE,label:"Meter",icon:"âš¡"}),e.jsx(C,{type:s.DELAY,label:"Delay",icon:"â±ï¸"}),e.jsx(C,{type:s.NOTIFICATION,label:"Message",icon:"ðŸ“¤"}),e.jsx(C,{type:s.CONNECTOR_PLUG,label:"Plug",icon:"ðŸ”Œ"}),e.jsx(C,{type:s.STATUS_TRIGGER,label:"StatusTrigger",icon:"ðŸš¦"}),e.jsx(C,{type:s.REMOTE_START_TRIGGER,label:"RemoteStart",icon:"ðŸŽ¬"})]})]}),e.jsx("div",{className:"flex-1 bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden min-h-0",children:e.jsxs(Je,{nodes:v,edges:A,onNodesChange:xe,onEdgesChange:me,onNodesDelete:ye,onConnect:he,onDrop:ve,onDragOver:fe,onNodeDoubleClick:Ae,nodeTypes:Et,deleteKeyCode:["Backspace","Delete"],fitView:!0,children:[e.jsx(Ke,{}),e.jsx(Xe,{}),e.jsx(qe,{})]})})]}),E&&e.jsxs("div",{className:"w-80 flex-shrink-0 panel p-4 overflow-y-auto max-h-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-bold text-primary",children:De(E.type||"")}),e.jsx("button",{onClick:()=>I(null),className:"text-muted hover:text-primary",children:"âœ•"})]}),Oe(),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx("button",{onClick:()=>I(null),className:"flex-1 btn-secondary text-sm",children:"Cancel"}),e.jsx("button",{onClick:()=>{ke(E.id,l),I(null)},className:"flex-1 btn-primary text-sm",children:"Save"})]})]})]})]})},C=({type:a,label:n,icon:r})=>{const m=S=>{S.dataTransfer.setData("application/reactflow",a),S.dataTransfer.effectAllowed="move"};return e.jsxs("div",{draggable:!0,onDragStart:m,className:"px-3 py-1 bg-gray-100 dark:bg-gray-700 rounded cursor-move hover:bg-gray-200 dark:hover:bg-gray-600 flex items-center gap-1 text-xs",children:[e.jsx("span",{children:r}),e.jsx("span",{className:"font-medium text-primary whitespace-nowrap",children:n})]})};function At(a,n){const r=`${a}-${Date.now()}`;switch(a){case s.STATUS_CHANGE:return{id:r,type:a,position:n,data:{label:"Status Change",status:d.Available}};case s.TRANSACTION:return{id:r,type:a,position:n,data:{label:"Transaction",action:"start",tagId:"123456"}};case s.METER_VALUE:return{id:r,type:a,position:n,data:{label:"Meter Value",value:10,sendMessage:!0}};case s.DELAY:return{id:r,type:a,position:n,data:{label:"Delay",delaySeconds:5}};case s.NOTIFICATION:return{id:r,type:a,position:n,data:{label:"Notification",messageType:"Heartbeat",payload:{}}};case s.CONNECTOR_PLUG:return{id:r,type:a,position:n,data:{label:"Connector Plug",action:"plugin"}};case s.REMOTE_START_TRIGGER:return{id:r,type:a,position:n,data:{label:"Wait for RemoteStart",timeout:0}};case s.STATUS_TRIGGER:return{id:r,type:a,position:n,data:{label:"Wait for Status",targetStatus:d.Charging,timeout:0}};case s.START:return{id:r,type:a,position:n,data:{label:"Start"}};case s.END:return{id:r,type:a,position:n,data:{label:"End"}};default:return{id:r,type:"default",position:n,data:{label:"Unknown"}}}}export{Mt as default};
