import{r as s,j as e,O as t,v as j}from"./index-BjgGgDfQ.js";import{H as c,P as p,i as H,B as R,C as P,M as W}from"./style-B2i4GXyF.js";const O=({data:a})=>{const{status:i,label:r,isCurrent:d,isOperative:f}=a,o=()=>{if(d)return"bg-blue-500 border-blue-700";if(!f)return"bg-gray-400 border-gray-600";switch(i){case t.Available:return"bg-green-400 border-green-600";case t.Preparing:return"bg-yellow-400 border-yellow-600";case t.Charging:return"bg-emerald-500 border-emerald-700";case t.SuspendedEV:case t.SuspendedEVSE:return"bg-orange-400 border-orange-600";case t.Finishing:return"bg-cyan-400 border-cyan-600";case t.Reserved:return"bg-purple-400 border-purple-600";case t.Unavailable:return"bg-gray-500 border-gray-700";case t.Faulted:return"bg-red-500 border-red-700";default:return"bg-gray-300 border-gray-500"}};return e.jsxs("div",{className:`px-4 py-2 shadow-lg rounded-lg border-2 ${o()} ${d?"ring-4 ring-blue-300 animate-pulse":""}`,style:{opacity:d?1:.4},children:[e.jsx(c,{type:"target",id:"top",position:p.Top,className:"w-3 h-3 !bg-gray-600"}),e.jsx(c,{type:"source",id:"top-source",position:p.Top,className:"w-3 h-3 !bg-gray-600"}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-sm font-bold text-white drop-shadow-md",children:r}),d&&e.jsx("div",{className:"mt-1 text-xs text-white font-semibold",children:"â— Current"})]}),e.jsx(c,{type:"source",id:"bottom",position:p.Bottom,className:"w-3 h-3 !bg-gray-600"}),e.jsx(c,{type:"target",id:"bottom-target",position:p.Bottom,className:"w-3 h-3 !bg-gray-600"}),e.jsx(c,{type:"target",id:"left",position:p.Left,className:"w-3 h-3 !bg-gray-600"}),e.jsx(c,{type:"source",id:"left-source",position:p.Left,className:"w-3 h-3 !bg-gray-600"}),e.jsx(c,{type:"source",id:"right",position:p.Right,className:"w-3 h-3 !bg-gray-600"}),e.jsx(c,{type:"target",id:"right-target",position:p.Right,className:"w-3 h-3 !bg-gray-600"})]})},C=s.memo(O),V=({history:a,onSelectTransition:i,currentIndex:r})=>{const[d,f]=s.useState(!1),[o,m]=s.useState(1),[u,g]=s.useState(!1);s.useEffect(()=>{if(!d||a.length===0)return;const l=setInterval(()=>{i(b=>{const B=b+1;return B>=a.length?u?0:(f(!1),b):B})},1e3/o);return()=>clearInterval(l)},[d,o,u,a.length,i]);const n=s.useCallback(()=>{f(l=>!l)},[]),h=s.useCallback(()=>{f(!1),i(Math.max(0,r-1))},[r,i]),v=s.useCallback(()=>{f(!1),i(Math.min(a.length-1,r+1))},[r,a.length,i]),x=s.useCallback(l=>{const b=l.currentTarget.getBoundingClientRect(),E=(l.clientX-b.left)/b.width,N=Math.floor(E*a.length);f(!1),i(Math.max(0,Math.min(a.length-1,N)))},[a.length,i]),y=l=>{switch(l){case t.Available:return"bg-green-400";case t.Preparing:return"bg-yellow-400";case t.Charging:return"bg-emerald-500";case t.SuspendedEV:case t.SuspendedEVSE:return"bg-orange-400";case t.Finishing:return"bg-cyan-400";case t.Reserved:return"bg-purple-400";case t.Unavailable:return"bg-gray-500";case t.Faulted:return"bg-red-500";default:return"bg-gray-300"}},S=l=>`${l.fromState} â†’ ${l.toState}`,k=l=>new Date(l).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit",second:"2-digit"});return a.length===0?e.jsx("div",{className:"p-4 text-center text-muted",children:"No state transition history yet"}):e.jsxs("div",{className:"flex flex-col h-full bg-gray-50 dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"p-3 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("button",{onClick:h,disabled:r===0,className:"btn-secondary text-xs px-2 py-1 disabled:opacity-30",title:"Previous",children:"â®ï¸"}),e.jsx("button",{onClick:n,className:"btn-primary text-xs px-3 py-1",title:d?"Pause":"Play",children:d?"â¸ï¸":"â¯ï¸"}),e.jsx("button",{onClick:v,disabled:r===a.length-1,className:"btn-secondary text-xs px-2 py-1 disabled:opacity-30",title:"Next",children:"â­ï¸"}),e.jsx("button",{onClick:()=>g(l=>!l),className:`text-xs px-2 py-1 rounded ${u?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 text-primary"}`,title:"Loop playback",children:"ðŸ”„"}),e.jsxs("select",{value:o,onChange:l=>m(Number(l.target.value)),className:"input-base text-xs py-1 px-2",children:[e.jsx("option",{value:.5,children:"0.5x"}),e.jsx("option",{value:1,children:"1x"}),e.jsx("option",{value:2,children:"2x"}),e.jsx("option",{value:4,children:"4x"})]}),e.jsxs("span",{className:"text-xs text-muted ml-auto",children:[r+1," / ",a.length]})]}),e.jsx("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full cursor-pointer overflow-hidden",onClick:x,children:e.jsx("div",{className:"h-full bg-blue-500 transition-all",style:{width:`${(r+1)/a.length*100}%`}})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-3",children:[e.jsx("h3",{className:"text-xs font-semibold text-primary mb-2",children:"ðŸ“‹ Transition History"}),e.jsx("div",{className:"space-y-2",children:a.map((l,b)=>e.jsxs("div",{onClick:()=>{f(!1),i(b)},className:`p-2 rounded cursor-pointer transition-colors ${b===r?"bg-blue-100 dark:bg-blue-900 border-2 border-blue-500":"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-750"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:"text-muted font-mono",children:k(l.timestamp)}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:`w-3 h-3 rounded ${y(l.fromState)}`}),e.jsx("span",{className:"text-primary font-medium",children:S(l)}),e.jsx("span",{className:`w-3 h-3 rounded ${y(l.toState)}`})]})]}),l.context.reason&&e.jsx("div",{className:"text-xs text-muted mt-1 ml-20",children:l.context.reason})]},l.id))})]})]})};function w(a,{autoRefresh:i=!0,historyOptions:r}={}){const{stateHistoryProvider:d}=j(),[f,o]=s.useState([]),[m,u]=s.useState(!!a);return s.useEffect(()=>{if(!a){o([]),u(!1);return}let g=null,n=!1;return d.getHistory(a,r).then(h=>{n||(o(h),u(!1))}).catch(h=>{console.error("Failed to fetch state history",h),u(!1)}),i&&(g=d.subscribe(a,o,r)),()=>{n=!0,g&&g()}},[i,a,r,d]),{history:f,isLoading:m}}const z={stateNode:C},U=({connector:a,chargePoint:i,className:r=""})=>{const[d,f]=s.useState(a.status),[o,m]=s.useState(-1),u=s.useMemo(()=>({entity:"connector",entityId:a.id,transitionType:"status"}),[a.id]),{history:g}=w(i.id,{historyOptions:u});s.useEffect(()=>{const x=a.events.on("statusChange",({status:y})=>{f(y),m(-1)});return()=>{x()}},[a]);const n=s.useMemo(()=>o>=0&&o<g.length?g[o].toState:d,[o,g,d]),h=s.useMemo(()=>[{id:"available",type:"stateNode",position:{x:500,y:600},data:{status:t.Available,label:"Available",isCurrent:n===t.Available,isOperative:!0}},{id:"preparing",type:"stateNode",position:{x:500,y:420},data:{status:t.Preparing,label:"Preparing",isCurrent:n===t.Preparing,isOperative:!0}},{id:"charging",type:"stateNode",position:{x:500,y:150},data:{status:t.Charging,label:"Charging",isCurrent:n===t.Charging,isOperative:!0}},{id:"suspendedEV",type:"stateNode",position:{x:150,y:80},data:{status:t.SuspendedEV,label:"Suspended (EV)",isCurrent:n===t.SuspendedEV,isOperative:!0}},{id:"suspendedEVSE",type:"stateNode",position:{x:850,y:80},data:{status:t.SuspendedEVSE,label:"Suspended (EVSE)",isCurrent:n===t.SuspendedEVSE,isOperative:!0}},{id:"finishing",type:"stateNode",position:{x:500,y:285},data:{status:t.Finishing,label:"Finishing",isCurrent:n===t.Finishing,isOperative:!0}},{id:"reserved",type:"stateNode",position:{x:150,y:600},data:{status:t.Reserved,label:"Reserved",isCurrent:n===t.Reserved,isOperative:!0}},{id:"unavailable",type:"stateNode",position:{x:850,y:600},data:{status:t.Unavailable,label:"Unavailable",isCurrent:n===t.Unavailable,isOperative:!1}},{id:"faulted",type:"stateNode",position:{x:500,y:780},data:{status:t.Faulted,label:"Faulted",isCurrent:n===t.Faulted,isOperative:!1}}],[n]),v=s.useMemo(()=>[{id:"available-preparing",source:"available",target:"preparing",sourceHandle:"top-source",targetHandle:"bottom-target",type:"smoothstep",label:"PLUGIN",animated:!0,style:{stroke:"#22c55e",strokeWidth:2},labelStyle:{fill:"#1f2937",fontWeight:600,fontSize:11},labelBgStyle:{fill:"#ffffff",fillOpacity:.9},labelBgPadding:[8,4],labelBgBorderRadius:4},{id:"available-reserved",source:"available",target:"reserved",sourceHandle:"left-source",targetHandle:"right-target",type:"smoothstep",label:"RESERVE",style:{stroke:"#a855f7",strokeWidth:2},labelStyle:{fill:"#1f2937",fontWeight:600,fontSize:11},labelBgStyle:{fill:"#ffffff",fillOpacity:.9},labelBgPadding:[8,4],labelBgBorderRadius:4},{id:"available-unavailable",source:"available",target:"unavailable",sourceHandle:"right",targetHandle:"left",type:"smoothstep",label:"SET_UNAVAILABLE",style:{stroke:"#6b7280",strokeWidth:2},labelStyle:{fill:"#1f2937",fontWeight:600,fontSize:11},labelBgStyle:{fill:"#ffffff",fillOpacity:.9},labelBgPadding:[8,4],labelBgBorderRadius:4},{id:"available-faulted",source:"available",target:"faulted",sourceHandle:"bottom",targetHandle:"top",type:"default",label:"ERROR",style:{stroke:"#ef4444",strokeWidth:2,strokeDasharray:"5, 5"},labelStyle:{fill:"#1f2937",fontWeight:600,fontSize:11},labelBgStyle:{fill:"#ffffff",fillOpacity:.9},labelBgPadding:[8,4],labelBgBorderRadius:4},{id:"preparing-charging",source:"preparing",target:"charging",sourceHandle:"top-source",targetHandle:"bottom-target",type:"smoothstep",label:"START_TX",animated:!0,style:{stroke:"#10b981",strokeWidth:2},labelStyle:{fill:"#1f2937",fontWeight:600,fontSize:11},labelBgStyle:{fill:"#ffffff",fillOpacity:.9},labelBgPadding:[8,4],labelBgBorderRadius:4},{id:"preparing-available",source:"preparing",target:"available",sourceHandle:"bottom",targetHandle:"top",type:"smoothstep",label:"PLUGOUT",style:{stroke:"#6b7280",strokeWidth:2},labelStyle:{fill:"#1f2937",fontWeight:600,fontSize:11},labelBgStyle:{fill:"#ffffff",fillOpacity:.9},labelBgPadding:[8,4],labelBgBorderRadius:4},{id:"preparing-faulted",source:"preparing",target:"faulted",sourceHandle:"right",targetHandle:"right-target",type:"default",label:"ERROR",style:{stroke:"#ef4444",strokeWidth:2,strokeDasharray:"5, 5"},labelStyle:{fill:"#1f2937",fontWeight:600,fontSize:11},labelBgStyle:{fill:"#ffffff",fillOpacity:.9},labelBgPadding:[8,4],labelBgBorderRadius:4},{id:"charging-suspendedEV",source:"charging",target:"suspendedEV",sourceHandle:"left-source",targetHandle:"right-target",type:"smoothstep",label:"SUSPEND_EV",style:{stroke:"#f97316",strokeWidth:2},labelStyle:{fill:"#1f2937",fontWeight:600,fontSize:11},labelBgStyle:{fill:"#ffffff",fillOpacity:.9},labelBgPadding:[8,4],labelBgBorderRadius:4},{id:"charging-suspendedEVSE",source:"charging",target:"suspendedEVSE",sourceHandle:"right",targetHandle:"left",type:"smoothstep",label:"SUSPEND_EVSE",style:{stroke:"#f97316",strokeWidth:2},labelStyle:{fill:"#1f2937",fontWeight:600,fontSize:11},labelBgStyle:{fill:"#ffffff",fillOpacity:.9},labelBgPadding:[8,4],labelBgBorderRadius:4},{id:"charging-finishing",source:"charging",target:"finishing",sourceHandle:"bottom",targetHandle:"top",type:"smoothstep",label:"STOP_TX",animated:!0,style:{stroke:"#06b6d4",strokeWidth:2},labelStyle:{fill:"#1f2937",fontWeight:600,fontSize:11},labelBgStyle:{fill:"#ffffff",fillOpacity:.9},labelBgPadding:[8,4],labelBgBorderRadius:4},{id:"charging-faulted",source:"charging",target:"faulted",sourceHandle:"left-source",targetHandle:"left",type:"default",label:"ERROR",style:{stroke:"#ef4444",strokeWidth:2,strokeDasharray:"5, 5"},labelStyle:{fill:"#1f2937",fontWeight:600,fontSize:11},labelBgStyle:{fill:"#ffffff",fillOpacity:.9},labelBgPadding:[8,4],labelBgBorderRadius:4},{id:"suspendedEV-charging",source:"suspendedEV",target:"charging",sourceHandle:"right",targetHandle:"left",type:"smoothstep",label:"RESUME",style:{stroke:"#10b981",strokeWidth:2},labelStyle:{fill:"#1f2937",fontWeight:600,fontSize:11},labelBgStyle:{fill:"#ffffff",fillOpacity:.9},labelBgPadding:[8,4],labelBgBorderRadius:4},{id:"suspendedEV-suspendedEVSE",source:"suspendedEV",target:"suspendedEVSE",sourceHandle:"top-source",targetHandle:"top",type:"smoothstep",label:"SUSPEND_EVSE",style:{stroke:"#f97316",strokeWidth:2},labelStyle:{fill:"#1f2937",fontWeight:600,fontSize:11},labelBgStyle:{fill:"#ffffff",fillOpacity:.9},labelBgPadding:[8,4],labelBgBorderRadius:4},{id:"suspendedEV-finishing",source:"suspendedEV",target:"finishing",sourceHandle:"bottom",targetHandle:"left",type:"smoothstep",label:"STOP_TX",style:{stroke:"#06b6d4",strokeWidth:2},labelStyle:{fill:"#1f2937",fontWeight:600,fontSize:11},labelBgStyle:{fill:"#ffffff",fillOpacity:.9},labelBgPadding:[8,4],labelBgBorderRadius:4},{id:"suspendedEVSE-charging",source:"suspendedEVSE",target:"charging",sourceHandle:"left-source",targetHandle:"right-target",type:"smoothstep",label:"RESUME",style:{stroke:"#10b981",strokeWidth:2},labelStyle:{fill:"#1f2937",fontWeight:600,fontSize:11},labelBgStyle:{fill:"#ffffff",fillOpacity:.9},labelBgPadding:[8,4],labelBgBorderRadius:4},{id:"suspendedEVSE-suspendedEV",source:"suspendedEVSE",target:"suspendedEV",sourceHandle:"top-source",targetHandle:"top",type:"smoothstep",label:"SUSPEND_EV",style:{stroke:"#f97316",strokeWidth:2},labelStyle:{fill:"#1f2937",fontWeight:600,fontSize:11},labelBgStyle:{fill:"#ffffff",fillOpacity:.9},labelBgPadding:[8,4],labelBgBorderRadius:4},{id:"suspendedEVSE-finishing",source:"suspendedEVSE",target:"finishing",sourceHandle:"bottom",targetHandle:"right-target",type:"smoothstep",label:"STOP_TX",style:{stroke:"#06b6d4",strokeWidth:2},labelStyle:{fill:"#1f2937",fontWeight:600,fontSize:11},labelBgStyle:{fill:"#ffffff",fillOpacity:.9},labelBgPadding:[8,4],labelBgBorderRadius:4},{id:"finishing-available",source:"finishing",target:"available",sourceHandle:"bottom",targetHandle:"top",type:"smoothstep",label:"PLUGOUT",animated:!0,style:{stroke:"#22c55e",strokeWidth:2},labelStyle:{fill:"#1f2937",fontWeight:600,fontSize:11},labelBgStyle:{fill:"#ffffff",fillOpacity:.9},labelBgPadding:[8,4],labelBgBorderRadius:4},{id:"finishing-faulted",source:"finishing",target:"faulted",sourceHandle:"left-source",targetHandle:"top",type:"default",label:"ERROR",style:{stroke:"#ef4444",strokeWidth:2,strokeDasharray:"5, 5"},labelStyle:{fill:"#1f2937",fontWeight:600,fontSize:11},labelBgStyle:{fill:"#ffffff",fillOpacity:.9},labelBgPadding:[8,4],labelBgBorderRadius:4},{id:"reserved-preparing",source:"reserved",target:"preparing",sourceHandle:"top-source",targetHandle:"left",type:"smoothstep",label:"PLUGIN",style:{stroke:"#22c55e",strokeWidth:2},labelStyle:{fill:"#1f2937",fontWeight:600,fontSize:11},labelBgStyle:{fill:"#ffffff",fillOpacity:.9},labelBgPadding:[8,4],labelBgBorderRadius:4},{id:"reserved-available",source:"reserved",target:"available",sourceHandle:"right",targetHandle:"left",type:"smoothstep",label:"CANCEL",style:{stroke:"#6b7280",strokeWidth:2},labelStyle:{fill:"#1f2937",fontWeight:600,fontSize:11},labelBgStyle:{fill:"#ffffff",fillOpacity:.9},labelBgPadding:[8,4],labelBgBorderRadius:4},{id:"reserved-faulted",source:"reserved",target:"faulted",sourceHandle:"bottom",targetHandle:"left",type:"default",label:"ERROR",style:{stroke:"#ef4444",strokeWidth:2,strokeDasharray:"5, 5"},labelStyle:{fill:"#1f2937",fontWeight:600,fontSize:11},labelBgStyle:{fill:"#ffffff",fillOpacity:.9},labelBgPadding:[8,4],labelBgBorderRadius:4},{id:"unavailable-available",source:"unavailable",target:"available",sourceHandle:"left-source",targetHandle:"right-target",type:"smoothstep",label:"SET_AVAILABLE",style:{stroke:"#22c55e",strokeWidth:2},labelStyle:{fill:"#1f2937",fontWeight:600,fontSize:11},labelBgStyle:{fill:"#ffffff",fillOpacity:.9},labelBgPadding:[8,4],labelBgBorderRadius:4},{id:"unavailable-faulted",source:"unavailable",target:"faulted",sourceHandle:"bottom",targetHandle:"right-target",type:"default",label:"ERROR",style:{stroke:"#ef4444",strokeWidth:2,strokeDasharray:"5, 5"},labelStyle:{fill:"#1f2937",fontWeight:600,fontSize:11},labelBgStyle:{fill:"#ffffff",fillOpacity:.9},labelBgPadding:[8,4],labelBgBorderRadius:4},{id:"faulted-available",source:"faulted",target:"available",sourceHandle:"top-source",targetHandle:"bottom-target",type:"smoothstep",label:"RESET",style:{stroke:"#22c55e",strokeWidth:2},labelStyle:{fill:"#1f2937",fontWeight:600,fontSize:11},labelBgStyle:{fill:"#ffffff",fillOpacity:.9},labelBgPadding:[8,4],labelBgBorderRadius:4},{id:"faulted-unavailable",source:"faulted",target:"unavailable",sourceHandle:"right",targetHandle:"bottom-target",type:"smoothstep",label:"SET_UNAVAILABLE",style:{stroke:"#6b7280",strokeWidth:2},labelStyle:{fill:"#1f2937",fontWeight:600,fontSize:11},labelBgStyle:{fill:"#ffffff",fillOpacity:.9},labelBgPadding:[8,4],labelBgBorderRadius:4}],[]);return e.jsxs("div",{className:`h-full w-full flex flex-col ${r}`,children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsxs(H,{nodes:h,edges:v,nodeTypes:z,nodesDraggable:!0,fitView:!0,attributionPosition:"bottom-left",minZoom:.5,maxZoom:2,defaultEdgeOptions:{markerEnd:{type:"arrowclosed",width:20,height:20}},children:[e.jsx(R,{}),e.jsx(P,{}),e.jsx(W,{nodeColor:x=>{var y,S;return(y=x.data)!=null&&y.isCurrent?"#3b82f6":(S=x.data)!=null&&S.isOperative?"#22c55e":"#6b7280"},nodeStrokeWidth:3})]}),e.jsxs("div",{className:"absolute top-4 right-4 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-lg text-sm",children:[e.jsx("h3",{className:"font-bold mb-2 text-gray-900 dark:text-white",children:"State Transition Diagram"}),e.jsxs("div",{className:"space-y-1 text-gray-700 dark:text-gray-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-blue-500 rounded"}),e.jsx("span",{children:"Current State"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-green-400 rounded"}),e.jsx("span",{children:"Available"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-emerald-500 rounded"}),e.jsx("span",{children:"Charging"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-orange-400 rounded"}),e.jsx("span",{children:"Suspended"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-400 rounded"}),e.jsx("span",{children:"Inoperative"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-red-500 rounded"}),e.jsx("span",{children:"Faulted"})]})]})]})]}),e.jsx("div",{className:"h-64 flex-shrink-0",children:e.jsx(V,{history:g,onSelectTransition:m,currentIndex:o})})]})};export{U as default};
